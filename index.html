<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>LocaMaq - Loca√ß√£o de M√°quinas</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF6B35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LocaMaq">
    <link rel="apple-touch-icon" href="logo.png">

    <link rel="stylesheet" href="styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div id="global-alert" role="alert"></div>

   <div id="home-screen" class="screen active">
        <div class="container">
            <div class="logo">
                <img src="logo.png" alt="LocaMaq Logo" class="logo-img">
                <p>Loca√ß√£o de M√°quinas e Equipamentos</p>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="showScreen('user-location-select')"> <span class="icon">üë∑</span> QUERO LOCAR UMA M√ÅQUINA OU FERRAMENTA
                </button>
                
                <button class="btn btn-secondary" onclick="showScreen('renter-login')">
                    <span class="icon">üõ†Ô∏è</span> QUERO OFERECER M√ÅQUINAS OU FERRAMENTAS PARA LOCA√á√ÉO
                </button>
            </div>
        </div>
    </div>

    <div id="user-login" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('home-screen')">‚Üê Voltar</button>
            <h2>Login do Usu√°rio</h2>
            <form onsubmit="userLogin(event)">
                <input type="email" id="user-email" placeholder="E-mail" required />
                <input type="password" id="user-password" placeholder="Senha" required />
                <button type="submit" class="btn btn-primary">Entrar</button>
            </form>
            <div class="links">
                <a href="#" onclick="showScreen('user-register')">Criar conta</a>
                <a href="#" onclick="showScreen('user-forgot-password')">Esqueci minha senha</a>
            </div>
        </div>
    </div>

    <div id="user-register" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('user-login')">‚Üê Voltar</button>
            <h2>Cadastro de Usu√°rio</h2>
            <form onsubmit="userRegister(event)">
                <input type="text" id="reg-user-name" placeholder="Nome Completo" required />
                <input type="tel" id="reg-user-phone" placeholder="Telefone" required />
                
                <div class="autocomplete-container">
                    <input type="text" id="reg-user-street" placeholder="Comece a digitar sua Rua..." autocomplete="off" oninput="handleAddressInput(event, 'reg-user-streetList')" required />
                    <div class="autocomplete-list" id="reg-user-streetList"></div>
                </div>
                
                <input type="text" id="reg-user-neighborhood" placeholder="Bairro" readonly />
                <input type="text" id="reg-user-city" placeholder="Cidade" readonly />
                <input type="text" id="reg-user-state" placeholder="Estado" readonly />
                
                <input type="email" id="reg-user-email" placeholder="E-mail" required />
                <input type="password" id="reg-user-password" placeholder="Senha" required />
                <input type="password" id="reg-user-confirm-password" placeholder="Confirmar Senha" required />
                <button type="submit" class="btn btn-primary">Cadastrar</button>
            </form>
        </div>
    </div>

    <div id="user-forgot-password" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('user-login')">‚Üê Voltar</button>
            <h2>Recuperar Senha</h2>
            <form onsubmit="recoverPassword(event, 'user')">
                <input type="email" id="recover-user-email" placeholder="E-mail cadastrado" required />
                <button type="submit" class="btn btn-primary">Enviar nova senha</button>
            </form>
        </div>
    </div>

    <div id="user-location-select" class="screen">
        <div class="container">
            <button class="btn-back" onclick="logout()">‚Üê Sair</button>
            <h2>Selecione sua Localiza√ß√£o</h2>
            <form onsubmit="searchRenters(event)">
                <select id="user-state-select" required onchange="loadCities(this.value, 'user-city-select')">
                    <option value="">Selecione o Estado</option>
                </select>
                <select id="user-city-select" required>
                    <option value="">Selecione a Cidade</option>
                </select>
                <button type="submit" class="btn btn-primary">Buscar Locadores</button>
            </form>
        </div>
    </div>

    <div id="user-dashboard" class="screen">
        <div class="container">
            <div class="header">
                <h2>Buscar Equipamentos</h2>
                <div class="header-icons">
                    <button class="btn-icon" onclick="showScreen('user-favorites')" title="Meus Favoritos">‚ù§Ô∏è</button>
                    <button class="btn-icon" onclick="showScreen('user-profile')" title="Meu Perfil">‚öôÔ∏è</button>
                </div>
            </div>
            
            <div class="search-box">
                <select id="equipment-select" class="w-full">
                    <option value="">-- Carregando equipamentos... --</option>
                </select>
                
                <div class="filters-row">
                    <select id="filter-voltage">
                        <option value="">Todas Tens√µes</option>
                        <option value="110V">110V</option>
                        <option value="220V">220V</option>
                        <option value="380V">380V</option>
                        <option value="Bivolt">Bivolt</option>
                    </select>
                    <input type="number" id="filter-max-price" placeholder="Pre√ßo m√°x (R$)" />
                </div>

                <button class="btn btn-primary" onclick="searchEquipment()">Pesquisar</button>
            </div>
            
            <div id="equipment-results" class="results-container"></div>
            <div id="map" style="height: 400px; margin-top: 20px;"></div>
            <button class="btn-back" onclick="showScreen('user-location-select')">‚Üê Alterar Localiza√ß√£o</button>
        </div>
    </div>

    <div id="user-favorites" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('user-dashboard')">‚Üê Voltar</button>
            <h2>Meus Favoritos ‚ù§Ô∏è</h2>
            <div id="favorites-list" class="results-container">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <div id="user-profile" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('user-dashboard')">‚Üê Voltar</button>
            <h2>Meu Perfil</h2>
            <form onsubmit="updateUserProfile(event)">
                <input type="text" id="edit-user-name" placeholder="Nome Completo" required />
                <input type="tel" id="edit-user-phone" placeholder="Telefone" required />
                
                <div class="autocomplete-container">
                    <input type="text" id="edit-user-street" placeholder="Digite o novo endere√ßo para alterar..." autocomplete="off" oninput="handleAddressInput(event, 'edit-user-streetList')" />
                    <div class="autocomplete-list" id="edit-user-streetList"></div>
                </div>

                <input type="text" id="edit-user-neighborhood" placeholder="Bairro" readonly />
                <input type="text" id="edit-user-city" placeholder="Cidade" readonly />
                <input type="text" id="edit-user-state" placeholder="Estado" readonly />
                <input type="email" id="edit-user-email" placeholder="E-mail" readonly />
                <button type="submit" class="btn btn-primary">Atualizar Dados</button>
            </form>
            <button class="btn btn-danger" onclick="logout()">Sair da Conta</button>
        </div>
    </div>

    <div id="renter-login" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('home-screen')">‚Üê Voltar</button>
            <h2>Login do Locador</h2>
            <form onsubmit="renterLogin(event)">
                <input type="email" id="renter-email" placeholder="E-mail" required />
                <input type="password" id="renter-password" placeholder="Senha" required />
                <button type="submit" class="btn btn-primary">Entrar</button>
            </form>
            <div class="links">
                <a href="#" onclick="showScreen('renter-register')">Criar conta</a>
                <a href="#" onclick="showScreen('renter-forgot-password')">Esqueci minha senha</a>
            </div>
        </div>
    </div>

    <div id="renter-register" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('renter-login')">‚Üê Voltar</button>
            <h2>Cadastro de Locador</h2>
            <form onsubmit="renterRegister(event)">
                <input type="text" id="reg-renter-name" placeholder="Nome / Empresa" required />
                <input type="tel" id="reg-renter-phone" placeholder="Telefone" required />

                 <div class="autocomplete-container">
                    <input type="text" id="reg-renter-street" placeholder="Comece a digitar sua Rua..." autocomplete="off" oninput="handleAddressInput(event, 'reg-renter-streetList')" required />
                    <div class="autocomplete-list" id="reg-renter-streetList"></div>
                </div>

                <input type="text" id="reg-renter-neighborhood" placeholder="Bairro" readonly />
                <input type="text" id="reg-renter-city" placeholder="Cidade" readonly />
                <input type="text" id="reg-renter-state" placeholder="Estado" readonly />
                <input type="hidden" id="reg-renter-lat" />
                <input type="hidden" id="reg-renter-lng" />
                
                <input type="email" id="reg-renter-email" placeholder="E-mail" required />
                <input type="password" id="reg-renter-password" placeholder="Senha" required />
                <input type="password" id="reg-renter-confirm-password" placeholder="Confirmar Senha" required />
                <button type="submit" class="btn btn-primary">Cadastrar</button>
            </form>
        </div>
    </div>

    <div id="renter-forgot-password" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('renter-login')">‚Üê Voltar</button>
            <h2>Recuperar Senha</h2>
            <form onsubmit="recoverPassword(event, 'renter')">
                <input type="email" id="recover-renter-email" placeholder="E-mail cadastrado" required />
                <button type="submit" class="btn btn-primary">Enviar nova senha</button>
            </form>
        </div>
    </div>

    <div id="renter-dashboard" class="screen">
        <div class="container">
            <div class="header">
                <h2>Meus Equipamentos</h2>
                <button class="btn-icon" onclick="showScreen('renter-profile')">‚öôÔ∏è</button>
            </div>
            <div class="plan-info" id="plan-info"></div>
            <button class="btn btn-primary" onclick="showScreen('add-equipment')">+ Adicionar Equipamento</button>
            <div id="equipment-list" class="equipment-list"></div>
            <button class="btn btn-upgrade" onclick="showScreen('upgrade-plan')">‚≠ê Melhorar Plano</button>
        </div>
    </div>

    <div id="add-equipment" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('renter-dashboard')">‚Üê Voltar</button>
            <h2 id="equipment-form-title">Adicionar Equipamento</h2>
            <form onsubmit="saveEquipment(event)">
                <input type="hidden" id="equipment-id" />
                <input type="text" id="equipment-name" placeholder="Nome do Equipamento" required />
                <textarea id="equipment-description" placeholder="Descri√ß√£o" rows="4" required></textarea>
                <input type="number" id="equipment-price" placeholder="Valor da Di√°ria (R$)" step="0.01" required />
                <select id="equipment-voltage" required>
                    <option value="">Tens√£o da Rede</option>
                    <option value="110V">110V</option>
                    <option value="220V">220V</option>
                    <option value="380V">380V (Trif√°sico)</option>
                    <option value="Bivolt">Bivolt</option>
                    <option value="N/A">N√£o se aplica</option>
                </select>
                
                <div style="position: relative; margin-top: 15px; margin-bottom: 15px; height: 50px;">
                    <div class="btn btn-secondary" style="display: flex; align-items: center; justify-content: center; gap: 10px; height: 100%; background-color: #e0f2fe; color: #0284c7; border: 2px dashed #7dd3fc;">
                        <span style="font-size: 1.5rem;">üì∑</span> 
                        <span>Tirar Foto Agora</span>
                    </div>

                    <input 
                        type="file" 
                        id="equipment-image" 
                        accept="image/*" 
                        capture="environment"
                        onchange="previewImage(event)" 
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 999;" 
                    />
                </div>
                
                <div id="image-preview" style="margin-top: 15px;"></div>
                <button type="submit" class="btn btn-primary">Salvar Equipamento</button>
            </form>
        </div>
    </div>

    <div id="upgrade-plan" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('renter-dashboard')">‚Üê Voltar</button>
            <h2>Escolha seu Plano</h2>
            <div class="plans-container">
                <div class="plan-card">
                    <h3>Gr√°tis</h3>
                    <p class="price">R$ 0,00</p>
                    <ul>
                        <li>1 equipamento</li>
                        <li>Altera√ß√£o de descri√ß√£o: 24h</li>
                    </ul>
                    <button id="btn-plan-free" class="btn btn-secondary" onclick="selectPlan('free')">Selecionar</button>
                </div>
                <div class="plan-card featured">
                    <h3>B√°sico</h3>
                    <p class="price">R$ 15,00<span>/m√™s</span></p>
                    <ul>
                        <li>10 equipamentos</li>
                        <li>Edi√ß√£o ilimitada</li>
                        <li>Destaque nas buscas</li>
                    </ul>
                    <button id="btn-plan-basic" class="btn btn-primary" onclick="selectPlan('basic')">Assinar</button>
                </div>
                <div class="plan-card featured">
                    <h3>Premium</h3>
                    <p class="price">R$ 30,00<span>/m√™s</span></p>
                    <ul>
                        <li>20 equipamentos</li>
                        <li>Edi√ß√£o ilimitada</li>
                        <li>Destaque nas buscas</li>
                        <li>Suporte priorit√°rio</li>
                    </ul>
                    <button id="btn-plan-premium" class="btn btn-primary" onclick="selectPlan('premium')">Assinar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="renter-profile" class="screen">
        <div class="container">
            <button class="btn-back" onclick="showScreen('renter-dashboard')">‚Üê Voltar</button>
            <h2>Meu Perfil</h2>
            <form onsubmit="updateRenterProfile(event)">
                <input type="text" id="edit-renter-name" placeholder="Nome / Empresa" required />
                <input type="tel" id="edit-renter-phone" placeholder="Telefone" required />
                
                <div class="autocomplete-container">
                    <input type="text" id="edit-renter-street" placeholder="Digite o novo endere√ßo para alterar..." autocomplete="off" oninput="handleAddressInput(event, 'edit-renter-streetList')" />
                    <div class="autocomplete-list" id="edit-renter-streetList"></div>
                </div>

                <input type="text" id="edit-renter-neighborhood" placeholder="Bairro" readonly />
                <input type="text" id="edit-renter-city" placeholder="Cidade" readonly />
                <input type="text" id="edit-renter-state" placeholder="Estado" readonly />
                <input type="email" id="edit-renter-email" placeholder="E-mail" readonly />
                <button type="submit" class="btn btn-primary">Atualizar Dados</button>
            </form>
            <button class="btn btn-danger" onclick="logout()">Sair da Conta</button>
        </div>
    </div>

    <div id="reset-password-screen" class="screen">
        <div class="container">
            <h2>Criar Nova Senha</h2>
            <p>Digite sua nova senha abaixo.</p>
            <form onsubmit="finishPasswordReset(event)">
                <input type="password" id="new-password" placeholder="Nova Senha" required />
                <input type="password" id="confirm-new-password" placeholder="Confirmar Nova Senha" required />
                <button type="submit" class="btn btn-primary">Redefinir Senha</button>
            </form>
        </div>
    </div>

    <div id="contact-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close-modal" onclick="closeContactModal()">√ó</button>
            
            <h3 id="modal-renter-name" class="modal-title">Nome do Locador</h3>
            <p>Entre em contato pelo n√∫mero:</p>
            
            <div id="modal-phone-display" class="modal-phone">(00) 00000-0000</div>
            
            <div class="modal-actions">
                <a id="btn-action-whatsapp" href="#" target="_blank" class="btn btn-whatsapp">
                    <span class="icon">üí¨</span> Conversar no WhatsApp
                </a>

                <a id="btn-action-call" href="#" class="btn btn-call">
                    <span class="icon">üìû</span> Ligar Agora
                </a>
                
                <button onclick="copyPhoneNumber()" class="btn btn-copy">
                    <span class="icon">üìã</span> Copiar N√∫mero
                </button>
            </div>
        </div>
    </div>

    <div id="review-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close-modal" onclick="closeReviewModal()">√ó</button>
            <h3 class="modal-title">Avaliar Locador</h3>
            <p style="margin-bottom: 15px; color: #64748b;">O que voc√™ achou do atendimento?</p>
            
            <div class="star-rating-input">
                <span class="star" onclick="selectStar(1)">‚òÖ</span>
                <span class="star" onclick="selectStar(2)">‚òÖ</span>
                <span class="star" onclick="selectStar(3)">‚òÖ</span>
                <span class="star" onclick="selectStar(4)">‚òÖ</span>
                <span class="star" onclick="selectStar(5)">‚òÖ</span>
            </div>
            
            <textarea id="review-comment" placeholder="Escreva um coment√°rio (opcional)..." rows="3"></textarea>
            
            <div class="modal-actions">
                <button onclick="submitReview()" class="btn btn-primary">Enviar Avalia√ß√£o</button>
            </div>
        </div>
    </div>

    <div id="read-reviews-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px; text-align: left;">
            <button class="btn-close-modal" onclick="closeReadReviewsModal()">√ó</button>
            <h3 class="modal-title" style="text-align: center;">Avalia√ß√µes do Locador</h3>
            
            <div id="reviews-list-container" style="max-height: 400px; overflow-y: auto; margin-top: 20px;">
                </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@11.0.0"></script>
    <script src="app.js"></script>
</body>
</html>
